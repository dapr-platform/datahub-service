绿云通用查询接口说明	
目录	一、整体思路及接口实现...................................................................................................................1	1.1 请求方式.........................................................................................................................1	1.2 安全校验机制.................................................................................................................1	1.3 获取 sessinid 请求.......................................................................................................... 1	1.4 刷新 sessinid 请求.......................................................................................................... 2	1.5 退出 sessinid 请求.......................................................................................................... 2	1.6 sign 计算..........................................................................................................................2	1.7 数据查询请求.................................................................................................................4	1.8 数据查询请求参数（示例）.........................................................................................5	1.9 响应结果(示例).............................................................................................................. 5	二、接口明细....................................................................................................................................... 6	2.1 实时房情数据............................................................................................................... 6	2.2 酒店排名........................................................................................................................6	2.3 平均房价走势.............................................................................................................. 7	2.4 营收情况详情.............................................................................................................. 7	2.5 营收情况列表.............................................................................................................. 8	
一、整体思路及接口实现	1.1 请求方式	基于 HTTP post 请求	Content-Type: application/x-www-form-urlencoded;charset=UTF-8	1.2 安全校验机制	每个酒店会申请分配给一套接口认证的用户名(usercode)、密码(password)、appKey、appSecret，	首次调用数据查询接口前，需要先获取 sessionid，本地保存的 sessionid 需要至少每 12 小时刷新一	次。	1.3 获取 sessinid 请求	http:// ip:port /ipmsgroup/router		参数：	参数	类型	描述	备注	
v	String	接口版本	默认传值 3.0	
hotelGroupCode	String	集团代码		
usercode	String	用户名		
password	String	密码		
method	String	操作类型	user.login	
local	String	语种	zh_CN	
format	String	参数格式	json	
appKey	String			
sign	String	参数签名		
	成功返回的信息：	参数	类型	描述	
resultCode	String	0	
resultMsg	String	成功	
resultInfo	String	返回 sessionId	
	失败返回的信息：	1	
参数	类型	描述	
errorToken	String	错误编码	
code	String	非 0	
message	String	错误描述	
solution	String	错误提醒	
1.4 刷新 sessinid 请求	http:// ip:port /ipmsgroup/router		参数：	参数	类型	描述	备注	
V	String	接口版本	3.0	
sessionId	String			
method	String	操作类型	user.refresh	
Local	String	语种	zh_CN	
format	String	参数格式	json	
appKey	String			
Sign	String	参数签名		
返回值说明同于获取 sessionid 返回值。	1.5 退出 sessinid 请求		参数：	参数	类型	描述	备注	
v	String	接口版本	3.0	
sessionId	String			
method	String	操作类型	user.logout	
local	String	语种	zh_CN	
format	String	参数格式	json	
appKey	String			
sign	String	参数签名		
1.6 sign 计算	将所有的请求参数参与计算	以获取 sessionId 接口为例，演示 sign 生成方式：	注：调用其他接口生成 sign 签名时主要代码区别在于请求参数 signParams.put 部分	public String getSign()	2	
{	Map<String,String> signParams = new HashMap<String, String>(); 	//1.1 接口所有请求参数，以获取 sessionId 接口为例，演示 sign 生成方式	signParams.put("hotelGroupCode", "LYG");	signParams.put("v", "3.0");	signParams.put("usercode", "test2");	signParams.put("method", "user.login");	signParams.put("local", "zh_CN");	signParams.put("format", "json");	signParams.put("password", "123456");	signParams.put("appKey", "10001");	//2.1 获取 signParams 中的 key 值	StringBuilder sb = new StringBuilder();	List<String> keyList = new ArrayList(signParams.size());	for (Map.Entry entry : signParams.entrySet()) {	keyList.add((String) entry.getKey());	}	//2.2 将 key 值进行排序	Collections.sort(keyList);	//2.3 根据排序后的 key 值按照下列各式输出	sb.append(appSecret);	for (String key : keyList) {	sb.append(key).append((String)signParams.get(key));	}	sb.append(appSecret);	//2.4 SHA1 加密后 将二进制输出为字符串	try	{	byte[] sha1Digest = getSHA1Digest(sb.toString());	3	
return byte2hex(sha1Digest);	} catch (IOException e) {	throw new RuntimeException("签名失败", e);	}	}	private static byte[] getSHA1Digest(String data) throws IOException {	byte[] bytes = null;	try {	MessageDigest md = MessageDigest.getInstance("SHA-1");	bytes = md.digest(data.getBytes("UTF-8"));	} catch (GeneralSecurityException gse) {	throw new IOException(gse.getMessage());	}	return bytes;	}	private static String byte2hex(byte[] bytes) {	StringBuilder sign = new StringBuilder();	for (int i = 0; i < bytes.length; i++) {	String hex = Integer.toHexString(bytes[i] & 0xFF);	if (hex.length() == 1) {	sign.append("0");	}	sign.append(hex.toUpperCase());	}	return sign.toString();	1.7 数据查询请求	数据查询请求： http://ip:port/ipmsgroup/router	4	
1.8 数据查询请求参数（示例）	参数名称	数据类型	描述	必输	参考值	
method	crs.kpi	固定值	String		
v	3.0	固定值	String		
format	json	固定值	String		
local	zh_CN	固定值	String		
appKey	10001		String		
sign	值待计算		String		
sessionId	sessionId 接 口	认证获取		String		
hotelGroupCode	集团代码		String	GCBZG	
hotelCode	酒店代码		String	GCBZ	
exec	方法名称		String	Kpi_Ihotel_Master_in	
params	参数	参数(就是过程的参数，以逗	号分隔)	String	集团代码,酒店代码	
1.9 响应结果(示例)	{	"resultCode": 0, 	// 0 代表成功，其他代表失败	"resultMsg": "成功", // 单独成功描述，或失败原因	"result": [	{	" HotelCode": "99", 	//酒店代码	" HotelDes": 99, 	//酒店名称	"Accnt": 99, 	//账号	" Sta": 99, 	//状态	" RoomNo ": 99, 	//房间号	" ArrDate": 99, 	//到达日期	" depDate": 99, 	//离开日期	},	]	}	5	
二、接口明细	2.1 实时房情数据	方法名称	Kpi_Ihotel_Room_Total	
说明	获取酒店实时数据	
传参说明	参数 1	参数 2		
	集团代码：	酒店代码：		
解释	集团代码：	酒店代码		
结果输出		
字段名	描述	类型	说明	
HotelCode	酒店代码	String		
HotelDesc	酒店名称	String		
RoomsTotalAmount	客房总数	Decimal		
RoomsAvlAmount	可用房数	Decimal		
RoomsSalesAmount	销售房数	Decimal		
RoomsOccAmount	出租率	Decimal		
2.2 酒店排名	方法名称	Kpi_Ihotel_Room_Rank	
说明	酒店排名	
传参说明	参数 1		
	集团代码：		
解释	集团代码：		
结果输出		
字段名	描述	类型	说明	
HotelCode	酒店代码	String		
HotelDesc	酒店名称	String		
RoomsRevAmount	客房营收	Decimal		
RoomsOccAmount	出租率	Decimal		
RoomsAdvAmount	平均房价	Decimal		
6	
2.3 平均房价走势	方法名称	Kpi_Ihotel_Room_Adr_List	
说明	近 10 日平均房价	
传参说明	参数 1	参数 2	
	集团代码：	酒店代码：	
解释	集团代码：	酒店代码	
结果输出		
字段名	描述	类型	说明	
HotelCode	酒店代码	String		
HotelDesc	酒店名称	String		
BizDate	月份日期	Datetime		
RoomsAdrAmount	平均房价	Decimal		
2.4 营收情况详情	方法名称	Kpi_Ihotel_Room_Detail	
说明	营收情况	
传参说明	参数 1	参数 2	
	集团代码：	酒店代码：	
解释	集团代码：	酒店代码	
结果输出		
字段名	描述	类型	说明	
HotelCode	酒店代码	String		
HotelDesc	酒店名称	String		
RoomsRmAmount	房费	Decimal		
RoomsFbAmount	餐费	Decimal		
RoomsMtAmount	会议	Decimal		
RoomsOtAmount	其它	Decimal		
7	
2.5 营收情况列表	方法名称	Kpi_Ihotel_Room_Detail_list	
说明	近 10 日营收情况列表	
传参说明	参数 1	参数 2	
	集团代码：	酒店代码：	
解释	集团代码：	酒店代码	
结果输出		
字段名	描述	类型	说明	
HotelCode	酒店代码	String		
HotelDesc	酒店名称	String		
BizDate	日期	Datetime		
RoomsRmAmount	房费	Decimal		
RoomsFbAmount	餐费	Decimal		
RoomsMtAmount	会议	Decimal		
RoomsOtAmount	其它	Decimal		
8	
